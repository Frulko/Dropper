{"version":3,"sources":["script.js"],"names":["dragged","lastHovered","scaleFactor","originalPosition","draggedClickPositionOffset","viewportEl","document","htmlEl","querySelector","addEventListener","style","transform","getPosByScale","pos","scale","event","target","getAttribute","classList","add","getBoundingClientRect","x","y","dataTransfer","setDragImage","createElement","opacity","preventDefault","contains","localName","remove","className","background","parentNode","removeChild","appendChild","console","log","fromID","toID"],"mappings":"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","file":"script.75da7f30.js","sourceRoot":"..","sourcesContent":["var dragged = null;\nvar lastHovered = null;\nconst scaleFactor = 0.5;\nlet originalPosition = [0, 0];\nlet draggedClickPositionOffset = [0, 0];\n\nconst viewportEl = document;\nconst htmlEl = document.querySelector('html');\n\ndocument.addEventListener('DOMContentLoaded', function() {\n  document.querySelector('#viewport').style.transform = `scale(${scaleFactor})`;\n  // console.log('viewport', document.querySelector('#viewport').style.transform)\n});\n\n\nconst getPosByScale = (pos) => {\n  // console.log('getPosByScale', pos, scaleFactor);\n  let scale = scaleFactor;\n  if (scaleFactor < 1) {\n    scale = 1 / scaleFactor;\n    return pos * scale;\n  }\n  return pos / scale;\n};\n\n/* Les événements sont déclenchés sur les objets glissables */\ndocument.addEventListener(\"drag\", function( event ) {\n  \n \n\n}, false);\n\nviewportEl.addEventListener('mousedown', function(event) {\n  // console.log('ok', event.target.getAttribute('draggable'));\n  if ( event.target.getAttribute('draggable') ) {\n    dragged = event.target;\n    dragged.classList.add('active');\n    const {x, y} = dragged.getBoundingClientRect();\n    draggedClickPositionOffset = [event.x - x, event.y - y];\n    originalPosition = [x, y];\n\n    // console.log([x, y]);\n    // console.log(dragged.getBoundingClientRect(), event.x, event.y)\n    // console.log(draggedClickPositionOffset);\n  }\n})\n\nviewportEl.addEventListener('mouseup', function(event) {\n  // console.log(dragged.style.transform);\n})\n\nviewportEl.addEventListener(\"dragstart\", function( event ) {\n    // Stocke une référence sur l'objet glissable\n    dragged = event.target;\n    \n    event.dataTransfer.setDragImage(document.createElement('img'), 0, 0);\n    \n    // transparence 50%\n    // event.target.style.opacity = .5;\n}, false);\n\nviewportEl.addEventListener(\"dragend\", function( event ) {\n    // reset de la transparence\n    event.target.style.opacity = \"\";\n}, false);\n\n/* Les événements sont déclenchés sur les cibles du drop */\nviewportEl.addEventListener(\"dragover\", function( event ) {\n    // Empêche default d'autoriser le drop\n    event.preventDefault();\n    // console.log(event.x, draggedClickPositionOffset[0]);\n  dragged.style.transform = `translate3d(${getPosByScale(event.x - draggedClickPositionOffset[0])}px, ${getPosByScale(event.y - draggedClickPositionOffset[1])}px, 0px)`\n}, false);\n\nviewportEl.addEventListener(\"dragenter\", function( event ) {\n    // Met en surbrillance la cible de drop potentielle lorsque l'élément glissable y entre\n    if ( event.target.classList.contains('node') && event.target !== dragged) {\n        // event.target.style.background = \"purple\";\n        event.target.classList.add('hover');\n        lastHovered = event.target;\n    }\n\n    \n\n}, false);\n\nviewportEl.addEventListener(\"dragleave\", function( event ) {\n    // reset de l'arrière-plan des potentielles cible du drop lorsque les éléments glissables les quittent\n    \n    if (event.target.localName !== 'html' && event.target) {\n      debugger;\n    }\n    \n    if ( event.target.classList.contains('node')) {\n        event.target.classList.remove('hover');\n        lastHovered = null;\n    }\n    \n    \n\n}, false);\n\nviewportEl.addEventListener(\"drop\", function( event ) {\n    // Empêche l'action par défaut (ouvrir comme lien pour certains éléments)\n    event.preventDefault();\n    // dragged.style.transform = `translate3d(${getPosByScale(event.x)}px, ${getPosByScale(event.y)}px, 0px)`\n    // Déplace l'élément traîné vers la cible du drop sélectionnée\n    if ( event.target.className == \"dropzone\" ) {\n        event.target.style.background = \"\";\n        dragged.parentNode.removeChild( dragged );\n        event.target.appendChild( dragged );\n    }\n\n    \n\n    if (lastHovered !== null) {\n      console.log(lastHovered, 'drop-over --> link two nodes and reset position')\n      const [x, y] = originalPosition;\n      //RESET NODE POSITION\n      dragged.style.transform = `translate3d(${getPosByScale(x)}px, ${getPosByScale(y)}px, 0px)`;\n      \n      const fromID = dragged.getAttribute('data-node');\n      const toID = lastHovered.getAttribute('data-node');\n      \n      \n      console.log('from', fromID, 'to', toID);\n      \n      lastHovered.classList.remove('hover');\n      lastHovered = null;\n    }\n\n    if ( dragged !== null ) {\n\n      \n\n      dragged.classList.remove('active');\n      dragged = null;\n    }\n\n\n    \n    \n  \n}, false);"]}